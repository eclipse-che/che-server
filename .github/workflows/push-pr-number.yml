#
# Copyright (c) 2020 Red Hat, Inc.
# This program and the accompanying materials are made
# available under the terms of the Eclipse Public License 2.0
# which is available at https://www.eclipse.org/legal/epl-2.0/
#
# SPDX-License-Identifier: EPL-2.0
#

name: set-pr-number

on:
  pull_request:
    types: [opened]

jobs:
  set-pr-number:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v3
    - name: Set PR number
      env:
        GIT_COMMITTER_NAME: ${{ github.event.pull_request.user.login }}
        GIT_COMMITTER_EMAIL: ${{ github.actor }}@users.noreply.github.com
      run: |
        mkdir -p ./shared-files
        echo -n "PR_IMAGE_TAG=pr-${{ github.event.number }}" > ./shared-files/pr-image-tag
        git config --local user.name "${{ env.GIT_COMMITTER_NAME }}"
        git config --local user.email "${{ env.GIT_COMMITTER_EMAIL }}"
        git add ./shared-files/pr-image-tag
        git commit -m "Set PR_IMAGE_TAG"
        git push origin HEAD:${{ github.head_ref }}
